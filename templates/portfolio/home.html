{% extends 'base.html' %}

{% block title %}정원 | 순천만 국제정원{% endblock %}

{% block content %}
<section class="relative">
    <style>
        .triple-carousel {
            height: 68vh;
        }
        .carousel-item {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 68%;
            max-width: 960px;
            transform: translate(-50%, -50%) scale(0.7);
            opacity: 0;
            transition: transform 700ms ease, opacity 700ms ease;
        }
        .carousel-item img {
            width: 100%;
            height: 100%;
            max-height: 60vh;
            object-fit: cover;
            border-radius: 8px;
            box-shadow: 0 30px 60px rgba(0, 0, 0, 0.15);
        }
        .carousel-item.is-center {
            opacity: 1;
            transform: translate(-50%, -50%) scale(1);
            z-index: 3;
        }
        .carousel-item.is-left {
            opacity: 0.55;
            transform: translate(-120%, -50%) scale(0.75);
            z-index: 2;
        }
        .carousel-item.is-right {
            opacity: 0.55;
            transform: translate(20%, -50%) scale(0.75);
            z-index: 2;
        }
        .carousel-item.is-hidden {
            opacity: 0;
            pointer-events: none;
        }
        @media (max-width: 768px) {
            .triple-carousel { height: 56vh; }
            .carousel-item { width: 88%; }
            .carousel-item.is-left { transform: translate(-140%, -50%) scale(0.7); }
            .carousel-item.is-right { transform: translate(40%, -50%) scale(0.7); }
        }
    </style>
    <div class="triple-carousel overflow-hidden bg-gray-100">
        <div class="h-full w-full relative">
            {% if recent_photos %}
                {% for photo in recent_photos %}
                    <div class="carousel-item" data-filename="{{ photo.original_filename|default:photo.image.name }}">
                        <img src="{{ photo.image.url }}" alt="{{ photo.title }}" />
                    </div>
                {% endfor %}
            {% else %}
                <div class="absolute inset-0 flex items-center justify-center">
                    <div class="text-gray-400">사진을 업로드해주세요.</div>
                </div>
            {% endif %}
        </div>
    </div>
    <div class="max-w-4xl mx-auto px-6 mt-4 text-center text-xs text-gray-500" id="carousel-caption"></div>
</section>

<section class="max-w-6xl mx-auto px-6 -mt-12 md:-mt-16 relative z-10">
    <div class="bg-white shadow-sm border border-gray-100 px-5 py-4 flex flex-wrap gap-4 text-xs text-gray-600">
        <span>최근 업로드한 50장의 사진을 슬라이드로 감상하세요.</span>
        <span>중앙의 큰 사진이 현재 선택된 컷입니다.</span>
    </div>
</section>

<section class="max-w-6xl mx-auto px-6 mt-16">
    <div class="flex items-end justify-between mb-8">
        <h2 class="text-2xl font-light">최근 기록</h2>
        <a href="{% url 'portfolio:archive' %}" class="text-xs text-gray-500 hover:text-gray-900">전체 보기</a>
    </div>

    {% if latest_photos %}
        <div class="masonry">
            {% for photo in latest_photos %}
                <article class="masonry-item">
                    <img src="{{ photo.image.url }}" alt="{{ photo.title }}" class="w-full h-auto rounded-sm" />
                    <div class="mt-3">
                        <h3 class="text-sm font-medium">{{ photo.title }}</h3>
                        <p class="text-xs text-gray-500 mt-1">
                            {% if photo.season %}{{ photo.season.name }}{% endif %}
                            {% if photo.zone %} · {{ photo.zone.name }}{% endif %}
                        </p>
                    </div>
                </article>
            {% endfor %}
        </div>
    {% else %}
        <div class="text-sm text-gray-500">아직 업로드된 사진이 없습니다.</div>
    {% endif %}
</section>

<script>
    const carouselItems = Array.from(document.querySelectorAll('.carousel-item'));
    const caption = document.getElementById('carousel-caption');
    let currentIndex = 0;

    const applyClasses = () => {
        const total = carouselItems.length;
        if (!total) {
            return;
        }
        carouselItems.forEach((item) => {
            item.classList.remove('is-center', 'is-left', 'is-right', 'is-hidden');
            item.classList.add('is-hidden');
            item.setAttribute('aria-hidden', 'true');
        });
        const leftIndex = (currentIndex - 1 + total) % total;
        const rightIndex = (currentIndex + 1) % total;

        carouselItems[currentIndex].classList.remove('is-hidden');
        carouselItems[currentIndex].classList.add('is-center');
        carouselItems[currentIndex].setAttribute('aria-hidden', 'false');

        if (total > 1) {
            carouselItems[leftIndex].classList.remove('is-hidden');
            carouselItems[leftIndex].classList.add('is-left');
            carouselItems[rightIndex].classList.remove('is-hidden');
            carouselItems[rightIndex].classList.add('is-right');
        }

        if (caption) {
            caption.textContent = carouselItems[currentIndex].dataset.filename || '';
        }
    };

    if (carouselItems.length) {
        applyClasses();
        setInterval(() => {
            currentIndex = (currentIndex + 1) % carouselItems.length;
            applyClasses();
        }, 4500);
    }
</script>
{% endblock %}
